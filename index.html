<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë„ì¿„ ê°€ì¡±ì—¬í–‰ 2026</title>
    <style>
        :root { --main: #ff4757; --bg: #f8f9fa; --card: #ffffff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding-bottom: 100px; color: #333; }
        
        /* ğŸ”’ ì ê¸ˆ í™”ë©´ */
        #lock-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--main); color: white; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 2000;
        }
        #pw-input { 
            width: 180px; padding: 15px; border: none; border-radius: 10px; 
            text-align: center; font-size: 1.5rem; margin-bottom: 20px; outline: none;
            letter-spacing: 5px;
        }
        #lock-screen button {
            padding: 12px 40px; border: none; border-radius: 25px; background: white; 
            color: var(--main); font-weight: bold; font-size: 1.1rem; cursor: pointer;
        }

        /* ğŸ“± ë©”ì¸ ì½˜í…ì¸  (ì²˜ìŒì—” ìˆ¨ê¹€) */
        #app-content { display: none; }
        .header { background: var(--main); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; font-weight: bold; }
        .card { background: var(--card); margin: 15px; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); display: none; }
        .card.active { display: block; }
        h2 { font-size: 1.2rem; color: var(--main); margin-top: 0; border-bottom: 2px solid #fff0f1; padding-bottom: 8px; }
        .info-item { font-size: 0.9rem; margin-bottom: 6px; padding-left: 10px; border-left: 3px solid #eee; }
        
        .photo-container { position: relative; display: inline-block; margin: 5px; }
        .photo-item { width: 95px; height: 95px; object-fit: cover; border-radius: 10px; border: 1px solid #eee; }
        .del-btn { position: absolute; top: -5px; right: -5px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; width: 22px; height: 22px; font-size: 12px; }
        
        textarea { width: 100%; height: 80px; border: 1px solid #eee; border-radius: 10px; padding: 10px; margin-top: 15px; box-sizing: border-box; background: #fffdf0; font-size: 0.9rem; }
        .upload-btn { display: inline-block; padding: 8px 15px; background: #f0f0f0; border-radius: 8px; font-size: 0.85rem; cursor: pointer; margin-top: 10px; border: 1px solid #ddd; }
        
        .nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 1px solid #eee; height: 75px; z-index: 100; }
        .nav-item { flex: 1; text-align: center; padding: 12px 0; color: #999; cursor: pointer; font-size: 0.75rem; }
        .nav-item.active { color: var(--main); font-weight: bold; background: #fffafa; }
    </style>
</head>
<body>

<div id="lock-screen">
    <h2>ğŸ”‘ ê°€ì¡± ì „ìš© ì•”í˜¸</h2>
    <input type="password" id="pw-input" maxlength="4" placeholder="4ìë¦¬ ìˆ«ì" inputmode="numeric">
    <button onclick="checkPassword()">ì…ì¥í•˜ê¸°</button>
</div>

<div id="app-content">
    <div class="header">ë„ì¿„ ê°€ì¡±ì—¬í–‰ ğŸ‡¯ğŸ‡µ</div>
    <div id="day1" class="card active">
        <h2>DAY 1: ê³µí•­ & ë„ì¿„íƒ€ì›Œ (1/16)</h2>
        <div class="info-item">âœˆï¸ 15:00 ë‚˜ë¦¬íƒ€ ë„ì°©</div>
        <div class="info-item">ğŸ¨ ì•„ì‚¬ì¿ ì‚¬ ë·° í˜¸í…” ì²´í¬ì¸</div>
        <div id="photos-day1"></div>
        <label class="upload-btn">ğŸ“· ì‚¬ì§„ ì¶”ê°€ <input type="file" hidden onchange="uploadPhoto('day1', this)"></label>
        <textarea id="memo-day1" onblur="saveMemo('day1')" placeholder="ë©”ëª¨ë¥¼ ë‚¨ê¸°ì„¸ìš”!"></textarea>
    </div>
    <div id="day2" class="card"><h2>DAY 2: ë””ì¦ˆë‹ˆì”¨ (1/17)</h2><div id="photos-day2"></div><label class="upload-btn">ğŸ“· ì‚¬ì§„ ì¶”ê°€ <input type="file" hidden onchange="uploadPhoto('day2', this)"></label><textarea id="memo-day2" onblur="saveMemo('day2')"></textarea></div>
    <div id="day3" class="card"><h2>DAY 3: ì‹œë¶€ì•¼ (1/18)</h2><div id="photos-day3"></div><label class="upload-btn">ğŸ“· ì‚¬ì§„ ì¶”ê°€ <input type="file" hidden onchange="uploadPhoto('day3', this)"></label><textarea id="memo-day3" onblur="saveMemo('day3')"></textarea></div>
    <div id="day4" class="card"><h2>DAY 4: í•˜ë¼ì£¼ì¿  (1/19)</h2><div id="photos-day4"></div><label class="upload-btn">ğŸ“· ì‚¬ì§„ ì¶”ê°€ <input type="file" hidden onchange="uploadPhoto('day4', this)"></label><textarea id="memo-day4" onblur="saveMemo('day4')"></textarea></div>
    <div id="day5" class="card"><h2>DAY 5: ê·€êµ­ (1/20)</h2><div id="photos-day5"></div><label class="upload-btn">ğŸ“· ì‚¬ì§„ ì¶”ê°€ <input type="file" hidden onchange="uploadPhoto('day5', this)"></label><textarea id="memo-day5" onblur="saveMemo('day5')"></textarea></div>

    <div class="nav">
        <div class="nav-item active" onclick="go(1)">16(ëª©)</div><div class="nav-item" onclick="go(2)">17(ê¸ˆ)</div><div class="nav-item" onclick="go(3)">18(í† )</div><div class="nav-item" onclick="go(4)">19(ì¼)</div><div class="nav-item" onclick="go(5)">20(ì›”)</div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getFirestore, doc, onSnapshot, setDoc, updateDoc, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-storage.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBweeHd4dCsd82Q2pDxPnP9IU6vjdi-S5M",
        authDomain: "tokyo-trip-2026-family.firebaseapp.com",
        projectId: "tokyo-trip-2026-family",
        storageBucket: "tokyo-trip-2026-family.firebasestorage.app",
        messagingSenderId: "669648921196",
        appId: "1:669648921196:web:79df32780bea9a4e6dee49"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // âœ… ë¹„ë°€ë²ˆí˜¸ ì²´í¬ (ê³µë°± ì œê±° ê¸°ëŠ¥ í¬í•¨)
    window.checkPassword = () => {
        const val = document.getElementById('pw-input').value.trim();
        if (val === "1214") {
            document.getElementById('lock-screen').style.display = 'none';
            document.getElementById('app-content').style.display = 'block';
        } else {
            alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤!");
            document.getElementById('pw-input').value = "";
        }
    };

    window.uploadPhoto = async (day, input) => {
        if (!input.files[0]) return;
        const file = input.files[0];
        const fileName = Date.now() + "_" + file.name;
        const storageRef = ref(storage, "photos/" + day + "/" + fileName);
        try {
            const snap = await uploadBytes(storageRef, file);
            const url = await getDownloadURL(snap.ref);
            await setDoc(doc(db, "travel", day), { photos: arrayUnion({ url, name: fileName }) }, { merge: true });
        } catch (e) { alert("ì—…ë¡œë“œ ì‹¤íŒ¨!"); }
    };

    window.deletePhoto = async (day, photoData) => {
        if (!confirm("ì‚­ì œí• ê¹Œìš”?")) return;
        try {
            await deleteObject(ref(storage, "photos/" + day + "/" + photoData.name));
            await updateDoc(doc(db, "travel", day), { photos: arrayRemove(photoData) });
        } catch (e) { alert("ì‚­ì œ ì‹¤íŒ¨!"); }
    };

    window.saveMemo = async (day) => {
        const val = document.getElementById("memo-" + day).value;
        await setDoc(doc(db, "travel", day), { memo: val }, { merge: true });
    };

    window.go = (n) => {
        document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById('day' + n).classList.add('active');
        document.querySelectorAll('.nav-item')[n-1].classList.add('active');
        window.scrollTo(0,0);
    };

    ['day1','day2','day3','day4','day5'].forEach(day =>
