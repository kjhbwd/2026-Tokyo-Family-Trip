<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë„ì¿„ ê°€ì¡±ì—¬í–‰ 2026</title>
    <style>
        :root { --main: #ff4757; --bg: #f8f9fa; --card: #ffffff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding-bottom: 100px; color: #333; }
        
        /* ì ê¸ˆ í™”ë©´ */
        #lock-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--main); color: white; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 2000;
        }
        #pw-input { 
            width: 180px; padding: 15px; border: none; border-radius: 10px; 
            text-align: center; font-size: 1.5rem; margin-bottom: 20px; outline: none;
        }
        #lock-screen button {
            padding: 12px 40px; border: none; border-radius: 25px; background: white; 
            color: var(--main); font-weight: bold; font-size: 1rem;
        }

        /* ë©”ì¸ ì½˜í…ì¸  */
        #app-content { display: none; }
        .header { background: var(--main); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; font-weight: bold; }
        .card { background: var(--card); margin: 15px; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); display: none; }
        .card.active { display: block; }
        h2 { font-size: 1.2rem; color: var(--main); margin-top: 0; border-bottom: 2px solid #fff0f1; padding-bottom: 8px; }
        .info-item { font-size: 0.9rem; margin-bottom: 6px; padding-left: 10px; border-left: 3px solid #eee; }
        
        .photo-container { position: relative; display: inline-block; margin: 5px; }
        .photo-item { width: 90px; height: 90px; object-fit: cover; border-radius: 8px; }
        .del-btn { 
            position: absolute; top: -5px; right: -5px; background: rgba(0,0,0,0.7); color: white; 
            border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 12px;
        }
        textarea { width: 100%; height: 80px; border: 1px solid #eee; border-radius: 10px; padding: 10px; margin-top: 15px; box-sizing: border-box; background: #fffdf0; font-size: 0.9rem; }
        .upload-btn { display: inline-block; padding: 7px 12px; background: #f0f0f0; border-radius: 6px; font-size: 0.8rem; margin: 10px 0; border: 1px solid #ddd; }
        
        .nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 1px solid #eee; height: 70px; z-index: 100; }
        .nav-item { flex: 1; text-align: center; padding: 10px 0; color: #999; font-size: 0.75rem; }
        .nav-item.active { color: var(--main); font-weight: bold; background: #fffafa; }
    </style>
</head>
<body>

<div id="lock-screen">
    <h2>ğŸ”’ ê°€ì¡± ì•”í˜¸</h2>
    <input type="password" id="pw-input" maxlength="4" placeholder="4ìë¦¬ ìˆ«ì">
    <button onclick="checkPassword()">ì…ì¥í•˜ê¸°</button>
</div>

<div id="app-content">
    <div class="header">ë„ì¿„ ê°€ì¡±ì—¬í–‰ ğŸ‡¯ğŸ‡µ</div>

    <div id="day1" class="card active">
        <h2>DAY 1: ê³µí•­ & ë„ì¿„íƒ€ì›Œ (1/16)</h2>
        <div class="info-item">âœˆï¸ 15:00 ë‚˜ë¦¬íƒ€ ë„ì°©</div>
        <div class="info-item">ğŸ¨ ì•„ì‚¬ì¿ ì‚¬ ë·° í˜¸í…” ì²´í¬ì¸</div>
        <div id="photos-day1"></div>
        <label class="upload-btn">ğŸ“· ì‚¬ì§„ ì¶”ê°€ <input type="file" hidden onchange="uploadPhoto('day1', this)"></label>
        <textarea id="memo-day1" onblur="saveMemo('day1')" placeholder="ë©”ëª¨ë¥¼ ë‚¨ê¸°ì„¸ìš”!"></textarea>
    </div>

    <div id="day2" class="card">
        <h2>DAY 2: ë””ì¦ˆë‹ˆì”¨ (1/17)</h2>
        <div class="info-item">ğŸ¡ í•˜ë£¨ì¢…ì¼ ë””ì¦ˆë‹ˆì”¨</div>
        <div id="photos-day2"></div>
        <label class="upload-btn">ğŸ“· ì‚¬ì§„ ì¶”ê°€ <input type="file" hidden onchange="uploadPhoto('day2', this)"></label>
        <textarea id="memo-day2" onblur="saveMemo('day2')" placeholder="ë””ì¦ˆë‹ˆì˜ ì¶”ì–µ!"></textarea>
    </div>

    <div id="day3" class="card">
        <h2>DAY 3: ì‹œë¶€ì•¼ & ì‹ ì£¼ì¿  (1/18)</h2>
        <div class="info-item">ğŸ™ï¸ ì‹œë¶€ì•¼ ìŠ¤ì¹´ì´ & ì „ë§ëŒ€</div>
        <div id="photos-day3"></div>
        <label class="upload-btn">ğŸ“· ì‚¬ì§„ ì¶”ê°€ <input type="file" hidden onchange="uploadPhoto('day3', this)"></label>
        <textarea id="memo-day3" onblur="saveMemo('day3')" placeholder="ì‡¼í•‘ ê¸°ë¡ ë“±"></textarea>
    </div>

    <div id="day4" class="card">
        <h2>DAY 4: í•˜ë¼ì£¼ì¿  & ì˜¤ëª¨í…Œì‚°ë„ (1/19)</h2>
        <div class="info-item">ğŸ¥ ë§›ì§‘ íƒë°© & ì¹´í˜</div>
        <div id="photos-day4"></div>
        <label class="upload-btn">ğŸ“· ì‚¬ì§„ ì¶”ê°€ <input type="file" hidden onchange="uploadPhoto('day4', this)"></label>
        <textarea id="memo-day4" onblur="saveMemo('day4')" placeholder="ì˜¤ëŠ˜ì˜ ë§›ì§‘ì€?"></textarea>
    </div>

    <div id="day5" class="card">
        <h2>DAY 5: ì•„ì‚¬ì¿ ì‚¬ & ê·€êµ­ (1/20)</h2>
        <div class="info-item">ğŸ® ì„¼ì†Œì§€ êµ¬ê²½ & ë©´ì„¸ì </div>
        <div class="info-item">âœˆï¸ ë‚˜ë¦¬íƒ€ ì¶œë°œ (ì˜¤í›„)</div>
        <div id="photos-day5"></div>
        <label class="upload-btn">ğŸ“· ì‚¬ì§„ ì¶”ê°€ <input type="file" hidden onchange="uploadPhoto('day5', this)"></label>
        <textarea id="memo-day5" onblur="saveMemo('day5')" placeholder="ë§ˆì§€ë§‰ ì†Œê°"></textarea>
    </div>

    <div class="nav">
        <div class="nav-item active" onclick="go(1)">16(ëª©)<br>1ì¼ì°¨</div>
        <div class="nav-item" onclick="go(2)">17(ê¸ˆ)<br>2ì¼ì°¨</div>
        <div class="nav-item" onclick="go(3)">18(í† )<br>3ì¼ì°¨</div>
        <div class="nav-item" onclick="go(4)">19(ì¼)<br>4ì¼ì°¨</div>
        <div class="nav-item" onclick="go(5)">20(ì›”)<br>5ì¼ì°¨</div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getFirestore, doc, onSnapshot, setDoc, updateDoc, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-storage.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBweeHd4dCsd82Q2pDxPnP9IU6vjdi-S5M",
        authDomain: "tokyo-trip-2026-family.firebaseapp.com",
        projectId: "tokyo-trip-2026-family",
        storageBucket: "tokyo-trip-2026-family.firebasestorage.app",
        messagingSenderId: "669648921196",
        appId: "1:669648921196:web:79df32780bea9a4e6dee49"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // ë¹„ë°€ë²ˆí˜¸ ì²´í¬ (2026)
    window.checkPassword = () => {
        const input = document.getElementById('pw-input').value;
        if (input === "2026") {
            document.getElementById('lock-screen').style.display = 'none';
            document.getElementById('app-content').style.display = 'block';
        } else {
            alert("í‹€ë ¸ìŠµë‹ˆë‹¤! ê°€ì¡± ì•”í˜¸ 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            document.getElementById('pw-input').value = "";
        }
    };

    // ì‚¬ì§„ ì—…ë¡œë“œ
    window.uploadPhoto = async (day, input) => {
        if (!input.files[0]) return;
        const file = input.files[0];
        const fileName = Date.now() + "_" + file.name;
        const storageRef = ref(storage, "photos/" + day + "/" + fileName);
        
        try {
            const snapshot = await uploadBytes(storageRef, file);
            const url = await getDownloadURL(snapshot.ref);
            await setDoc(doc(db, "travel", day), { 
                photos: arrayUnion({ url: url, name: fileName }) 
            }, { merge: true });
        } catch (e) { alert("ì—…ë¡œë“œ ì‹¤íŒ¨! ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”."); }
    };

    // ì‚¬ì§„ ì‚­ì œ
    window.deletePhoto = async (day, photoData) => {
        if (!confirm("ì§€ìš¸ê¹Œìš”?")) return;
        try {
            await deleteObject(ref(storage, "photos/" + day + "/" + photoData.name));
            await updateDoc(doc(db, "travel", day), { photos: arrayRemove(photoData) });
        } catch (e) { alert("ì‚­ì œ ì‹¤íŒ¨!"); }
    };

    // ë©”ëª¨ ì €ì¥
    window.saveMemo = async (day) => {
        const val = document.getElementById("memo-" + day).value;
        await setDoc(doc(db, "travel", day), { memo: val }, { merge: true });
    };

    // í™”ë©´ ì „í™˜
    window.go = (n) => {
        document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById('day' + n).classList.add('active');
        document.querySelectorAll('.nav-item')[n-1].classList.add('active');
        window.scrollTo(0,0);
    };

    // ì‹¤ì‹œê°„ ë™ê¸°í™”
    ['day1','day2','day3','day4','day5'].forEach(day => {
        onSnapshot(doc(db, "travel", day), (docSnap) => {
            if (docSnap.exists()) {
                const data = docSnap.data();
                if (document.getElementById("memo-" + day)) document.getElementById("memo-" + day).value = data.memo || "";
                const photoDiv = document.getElementById("photos-" + day);
                if (photoDiv) {
                    photoDiv.innerHTML = (data.photos || []).map(p => `
                        <div class="photo-container">
                            <img src="${p.url}" class="photo-item">
                            <button class="del-btn" onclick="deletePhoto('${day}', ${JSON.stringify(p).replace(/"/g, '&quot;')})">âœ•</button>
                        </div>
                    `).join('');
                }
            }
        });
    });
</script>
</body>
</html>
